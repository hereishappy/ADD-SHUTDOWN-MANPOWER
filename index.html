<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
    </style>
</head>
<body class="p-4">
    <!-- Password Protection Modal -->
    <div id="passwordModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-lg p-6 max-w-sm mx-4 w-full">
            <div class="mb-6 text-center">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Access Required</h2>
                <div class="w-12 h-1 bg-gray-500 rounded mx-auto"></div>
            </div>
            
            <form id="passwordForm" class="space-y-4">
                <div>
                    <input 
                        type="password" 
                        id="accessPassword" 
                        placeholder="Enter Access Code"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-gray-500 focus:border-transparent outline-none transition-all"
                        required
                    >
                </div>
                
                <button 
                    type="submit"
                    class="w-full bg-gray-600 hover:bg-gray-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200"
                >
                    Access App
                </button>
            </form>
            
            <div id="passwordError" class="mt-4 text-sm text-center text-red-600 hidden">
                Invalid access code. Please try again.
            </div>
        </div>
    </div>

    <div id="mainApp" class="max-w-md mx-auto space-y-6 hidden">
        <!-- Card 1: Add Employee -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Add Employee</h2>
                <div class="w-12 h-1 bg-blue-500 rounded"></div>
            </div>
            
            <form id="employeeForm" class="space-y-4">
                <div>
                    <input 
                        type="text" 
                        id="employeeName" 
                        placeholder="Employee Name"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                        required
                    >
                </div>
                
                <button 
                    type="submit"
                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 transform hover:scale-[1.02]"
                >
                    Add Employee
                </button>
            </form>
            
            <div id="employeeStatus" class="mt-4 text-sm text-center hidden"></div>
        </div>

        <!-- Card 2: Add Supervisor -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <div class="mb-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-2">Add Supervisor</h2>
                <div class="w-12 h-1 bg-purple-500 rounded"></div>
            </div>
            
            <form id="supervisorForm" class="space-y-4">
                <div>
                    <input 
                        type="text" 
                        id="supervisorName" 
                        placeholder="Supervisor Name"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                        required
                    >
                </div>
                
                <div>
                    <input 
                        type="password" 
                        id="supervisorPassword" 
                        placeholder="4-Digit Password"
                        maxlength="4"
                        pattern="[0-9]{4}"
                        class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none transition-all"
                        required
                    >
                </div>
                
                <button 
                    type="submit"
                    class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 transform hover:scale-[1.02]"
                >
                    Add Supervisor
                </button>
            </form>
            
            <div id="supervisorStatus" class="mt-4 text-sm text-center hidden"></div>
        </div>
    </div>

    <script>
        // Password protection
        const ACCESS_CODE = '119034';
        
        // Check if user is already authenticated
        if (sessionStorage.getItem('authenticated') === 'true') {
            document.getElementById('passwordModal').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
        }

        // Password form handler
        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const enteredPassword = document.getElementById('accessPassword').value;
            const errorDiv = document.getElementById('passwordError');
            
            if (enteredPassword === ACCESS_CODE) {
                // Correct password
                sessionStorage.setItem('authenticated', 'true');
                document.getElementById('passwordModal').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');
                errorDiv.classList.add('hidden');
            } else {
                // Wrong password
                errorDiv.classList.remove('hidden');
                document.getElementById('accessPassword').value = '';
                document.getElementById('accessPassword').focus();
            }
        });

        // Google Sheet configuration
        const SHEET_CONFIG = {
            sheetId: '1Cm1tisaD_dhRcmE5eO7_wf-OUnUVvhuH8mJrz_SAabo',
            employeeSheet: 'EMP LIST',
            configSheet: 'CONFIG'
        };

        // Google Apps Script web app URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxpja255N3Y0dBBz32gAoYSRRloI6F1pReyJTLP290cbvsHcG5OhtW63qSA8_uqTuZi-w/exec';

        // Employee form handler
        document.getElementById('employeeForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const employeeName = document.getElementById('employeeName').value.trim();
            const statusDiv = document.getElementById('employeeStatus');
            
            if (!employeeName) {
                showStatus(statusDiv, 'Please enter an employee name', 'error');
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Adding...';
            submitBtn.disabled = true;

            try {
                const data = {
                    sheet: SHEET_CONFIG.employeeSheet,
                    values: [[employeeName]],
                    range: 'A2'
                };

                await callGoogleScript(data);
                
                showStatus(statusDiv, `Employee "${employeeName}" added successfully!`, 'success');
                document.getElementById('employeeName').value = '';
                
            } catch (error) {
                showStatus(statusDiv, 'Error adding employee. Please try again.', 'error');
                console.error('Error:', error);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Supervisor form handler
        document.getElementById('supervisorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const supervisorName = document.getElementById('supervisorName').value.trim();
            const password = document.getElementById('supervisorPassword').value;
            const statusDiv = document.getElementById('supervisorStatus');
            
            if (!supervisorName || !password) {
                showStatus(statusDiv, 'Please fill in all fields', 'error');
                return;
            }

            if (!/^\d{4}$/.test(password)) {
                showStatus(statusDiv, 'Password must be exactly 4 digits', 'error');
                return;
            }

            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Adding...';
            submitBtn.disabled = true;

            try {
                const data = {
                    sheet: SHEET_CONFIG.configSheet,
                    values: [[supervisorName, password]],
                    range: 'A:B'
                };

                await callGoogleScript(data);
                
                showStatus(statusDiv, `Supervisor "${supervisorName}" added successfully!`, 'success');
                document.getElementById('supervisorName').value = '';
                document.getElementById('supervisorPassword').value = '';
                
            } catch (error) {
                showStatus(statusDiv, 'Error adding supervisor. Please try again.', 'error');
                console.error('Error:', error);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        // Utility functions
        function showStatus(element, message, type) {
            element.textContent = message;
            element.className = `mt-4 text-sm text-center ${type === 'success' ? 'text-green-600' : 'text-red-600'}`;
            element.classList.remove('hidden');
            
            setTimeout(() => {
                element.classList.add('hidden');
            }, 3000);
        }

        async function callGoogleScript(data) {
            try {
                // Use FormData for Google Apps Script compatibility
                const formData = new FormData();
                formData.append('data', JSON.stringify(data));

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: formData,
                    redirect: 'follow'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                
                if (result.success === false) {
                    throw new Error(result.error || 'Unknown error occurred');
                }

                return result;
            } catch (error) {
                console.error('Error calling Google Script:', error);
                
                // More detailed error information
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Network error - check your internet connection');
                } else if (error.message.includes('CORS')) {
                    throw new Error('CORS error - check Google Apps Script deployment settings');
                } else {
                    throw new Error(`Connection failed: ${error.message}`);
                }
            }
        }

        // Password input validation
        document.getElementById('supervisorPassword').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a5767fb68dc464',t:'MTc1NzA3MjU0NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
